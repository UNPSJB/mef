<h1>Lista de pedidos
  <a class="btn btn-success" href="/pedidos/agregar" role="button">Crear Pedido</a>
</h1>

<div class="container">
  {{#if pedidos}}
  <table class="table" id="datatable">
    <thead>
      <th>#</th>
      <th>Autorizado</th>
      <th>Estado</th>
      <th>Cliente</th>
      <th>Motivo</th>
      <th>Acciones</th>
    </thead>
    <tbody>
      {{/if}}
      {{#each pedidos}}
      <tr class="{{this.estadoInstance}}">
        <td class="id">{{this.id}}</td>
        <td>{{#if this.autorizacion}}
          Si
          {{else}}
          No
          {{/if}}
        </td>
        <td>{{this.estadoInstance}}</td>
        <td class="cliente">
          {{#with this.Persona as |Cliente|}}
          {{Cliente.nombre}} {{Cliente.apellido}}
          {{else}}
          <i>Interno</i>
          {{/with}}
        </td>
        <td>
          {{#with this.motivo}}
          {{this}}
          {{else}}
          <i>No hay descripcion</i>
          {{/with}}
        </td>
      </tr>
      {{else}}
      <div class="container pt-4 text-center">
        <h3>No hay pedidos agregados.</h3>
      </div>
      {{/each}}
      {{#if pedidos}}
    </tbody>
  </table>
  {{/if}}
</div>

<script>
  const rol = "{{req.session.rol}}";
  $(".Presupuestado").each(function () {
    if (rol === 'exhibicion') {
      $(this).append("<td>" +
        fabricar("detalle", $(this).find('.id')[0].innerText) +
        fabricar("facturar", $(this).find('.id')[0].innerText) +
        fabricar("cancelar", $(this).find('.id')[0].innerText) + "</td>");
    }
    if (rol === 'taller') {
      $(this).append("<td> " +
        fabricar("detalle", $(this).find('.id')[0].innerText) +"</td>");
    }
  })
  $(".Facturado").each(function () {
    if (rol === 'exhibicion') {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) +
      fabricar("confirmar", $(this).find('.id')[0].innerText) + "</td>")
    }
    if (rol === 'taller') {
      $(this).append("<td> " +
        fabricar("detalle", $(this).find('.id')[0].innerText) +"</td>");
    }

  })
  $(".Confirmado").each(function () {
    if (rol === 'exhibicion') {
      $(this).append("<td> " +
        fabricar("detalle", $(this).find('.id')[0].innerText) +"</td>");
    }
    if (rol === 'taller') {
      $(this).append("<td>" +
        fabricar("detalle", $(this).find('.id')[0].innerText) +
        fabricar("fabricar", $(this).find('.id')[0].innerText) + "</td>")
    }
  })
  $(".Fabricando").each(function () {
    if (rol === 'exhibicion') {
      $(this).append("<td> " +
        fabricar("detalle", $(this).find('.id')[0].innerText) +"</td>");
    }
    if (rol === 'taller') {
      $(this).append("<td>" +
        fabricar("detalle", $(this).find('.id')[0].innerText) +
        fabricar("finalizar", $(this).find('.id')[0].innerText) +
        fabricar("demorar", $(this).find('.id')[0].innerText) +
        fabricar("empleados", $(this).find('.id')[0].innerText) +"</td>")
    }

  })
  $(".Demorado").each(function () {
    if (rol === 'exhibicion') {
      $(this).append("<td> " +
        fabricar("detalle", $(this).find('.id')[0].innerText) +"</td>");
    }
    if (rol === 'taller') {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) +
      fabricar("reanudar", $(this).find('.id')[0].innerText) + "</td>")
    }
  })
  $(".Finalizado").each(function () {
    if (rol === 'exhibicion') {
      $(this).append("<td> " +
        fabricar("detalle", $(this).find('.id')[0].innerText) +"</td>");
    }
    if (rol === 'taller') {
      let cliente = $(this).find('.cliente')[0].innerText;
      if (cliente === 'Interno') {
        $(this).append("<td>" +
          fabricar("detalle", $(this).find('.id')[0].innerText) +"</td>")
      } else {
        $(this).append("<td>" +
          fabricar("detalle", $(this).find('.id')[0].innerText) +
          fabricar("entregar", $(this).find('.id')[0].innerText) + "</td>")
      }
    }

  })
  $(".Entregado").each(function () {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) +"</td>")
  })
  $(".Cancelado").each(function () {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) +"</td>")
  })

  function fabricar(accion, id) {
    let capitlizado = accion.charAt(0).toUpperCase() + accion.slice(1);
    return `<a id='${accion}' class='btn btn-primary' href='/pedidos/${accion}/${id}'>${capitlizado}</a>`;
  }
</script>