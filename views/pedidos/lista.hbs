<h1 class="bg-secondary text-center text-white rounded p-2 mt-2">
  Pedidos
  <a class="btn btn-success btn-primary border border-light" href="/pedidos/agregar" role="button">
    +
  </a>
  <a class="btn btn-success btn-info border border-light" href="pedidos/replicas" role="button">
    Replicas Terminadas
  </a>
</h1>

<div class="container">
  <table class="table" id="pedidos">
    <thead>
      <th>#</th>
      <th>Estado</th>
      <th>Cliente</th>
      <th>Descripcion</th>
      <th>Acciones</th>
    </thead>
    <tbody>
      {{#each pedidos}}
      <tr class="{{this.estadoInstance}}">
        <td class="id">{{this.id}}</td>
        <td>{{this.estadoInstance}}</td>
        <td class="cliente">
          {{#with this.Persona as |Cliente|}}
          {{Cliente.nombre}} {{Cliente.apellido}}
          {{else}}
          <i>Interno</i>
          {{/with}}
        </td>
        <td>
          {{#with this.motivo}}
          {{this}}
          {{else}}
          <i>No hay descripcion</i>
          {{/with}}
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
</div>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
<script>
  $(document).ready(function () {
    $('#pedidos').DataTable({
      searching: true,
      ordering: true,
      language: {
        processing: "Buscando...",
        search: "Buscar:",
        lengthMenu: "Mostrando _MENU_",
        info: "Mostrando _START_ de _END_ de un total de _TOTAL_ ",
        infoEmpty: "Mostrando 0 de 0 de un total de 0 ",
        infoFiltered: "(de un total de _MAX_)",
        infoPostFix: "",
        loadingRecords: "Cargando...",
        zeroRecords: "No hay elementos agregados",
        emptyTable: "No hay elementos :(",
        paginate: {
          first: "Primero",
          previous: "Anterior",
          next: "Siguiente",
          last: "Ãšltimo"
        },
        aria: {
          sortAscending: ": Ordenar ascendente",
          sortDescending: ": Ordenar descendente"
        }
      }
    });
  });
</script>


<script>
  $(".Presupuestado").each(function () {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) +
      fabricar("facturar", $(this).find('.id')[0].innerText) +
      fabricar("cancelar", $(this).find('.id')[0].innerText) + "</td>");
  })
  $(".Facturado").each(function () {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) +
      fabricar("confirmar", $(this).find('.id')[0].innerText) + "</td>")
  })
  $(".Confirmado").each(function () {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) +
      fabricar("fabricar", $(this).find('.id')[0].innerText) + "</td>")
  })
  $(".Fabricando").each(function () {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) +
      fabricar("finalizar", $(this).find('.id')[0].innerText) +
      fabricar("demorar", $(this).find('.id')[0].innerText) +
      fabricar("empleados", $(this).find('.id')[0].innerText) + "</td>")
  })
  $(".Demorado").each(function () {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) +
      fabricar("reanudar", $(this).find('.id')[0].innerText) + "</td>")
  })
  $(".Finalizado").each(function () {
    let cliente = $(this).find('.cliente')[0].innerText;
    if (cliente === 'Interno') {
      $(this).append("<td>" +
        fabricar("detalle", $(this).find('.id')[0].innerText) + "</td>")
    } else {
      $(this).append("<td>" +
        fabricar("detalle", $(this).find('.id')[0].innerText) +
        fabricar("entregar", $(this).find('.id')[0].innerText) + "</td>")
    }
  })
  $(".Entregado").each(function () {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) + "</td>")
  })
  $(".Cancelado").each(function () {
    $(this).append("<td>" +
      fabricar("detalle", $(this).find('.id')[0].innerText) + "</td>")
  })

  function fabricar(accion, id) {
    let capitlizado = accion.charAt(0).toUpperCase() + accion.slice(1);
    return `<a id='${accion}' class='btn btn-primary' href='/pedidos/${accion}/${id}'>${capitlizado}</a>`;
  }
</script>